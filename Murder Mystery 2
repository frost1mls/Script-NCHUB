-- NCHUB - Biblioteca Personaliz√°vel (Minimizar reduz o GUI todo)
-- Top bar com tudo, conte√∫do livre embaixo
-- SUA BIBLIOTECA 100% PRESERVADA + FUN√á√ïES REAIS

-- Criar tela
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NCHUB"
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Tela de carregamento
local loadingFrame = Instance.new("Frame")
loadingFrame.Name = "Loading"
loadingFrame.Size = UDim2.new(0, 150, 0, 70)
loadingFrame.Position = UDim2.new(0.5, -75, 0.5, -35)
loadingFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
loadingFrame.BackgroundTransparency = 0.1
loadingFrame.BorderSizePixel = 0
loadingFrame.Parent = screenGui
loadingFrame.ZIndex = 10

local loadingCorner = Instance.new("UICorner")
loadingCorner.CornerRadius = UDim.new(0, 12)
loadingCorner.Parent = loadingFrame

local loadingText = Instance.new("TextLabel")
loadingText.Size = UDim2.new(1, 0, 1, 0)
loadingText.BackgroundTransparency = 1
loadingText.Text = "NCHUB"
loadingText.TextColor3 = Color3.fromRGB(255, 255, 255)
loadingText.Font = Enum.Font.GothamBold
loadingText.TextSize = 28
loadingText.Parent = loadingFrame

-- Aguardar 2 segundos
task.wait(2)

loadingFrame:TweenPosition(UDim2.new(0.5, -75, 1.5, 0), "Out", "Quad", 0.5, true)
task.wait(0.5)
loadingFrame:Destroy()

-- GUI Principal
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 480, 0, 620)  -- aumentei pra caber tudo sem cortar
mainFrame.Position = UDim2.new(0.5, -240, 0.5, -310)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 16)
mainCorner.Parent = mainFrame

-- TOP BAR
local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(1, 0, 0, 45)
topBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
topBar.BorderSizePixel = 0
topBar.Parent = mainFrame

local topBarCorner = Instance.new("UICorner")
topBarCorner.CornerRadius = UDim.new(0, 16)
topBarCorner.Parent = topBar

-- Nome do Hub
local hubName = Instance.new("TextLabel")
hubName.Size = UDim2.new(0, 120, 1, 0)
hubName.Position = UDim2.new(0, 12, 0, 0)
hubName.BackgroundTransparency = 1
hubName.Text = "NCHUB"
hubName.TextColor3 = Color3.fromRGB(255, 255, 255)
hubName.Font = Enum.Font.GothamBold
hubName.TextSize = 18
hubName.TextXAlignment = Enum.TextXAlignment.Left
hubName.Parent = topBar

-- Container dos bot√µes
local buttonContainer = Instance.new("Frame")
buttonContainer.Size = UDim2.new(0, 120, 1, 0)
buttonContainer.Position = UDim2.new(1, -130, 0, 0)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = topBar

-- Bot√£o Config
local configBtn = Instance.new("TextButton")
configBtn.Size = UDim2.new(0, 30, 1, 0)
configBtn.Position = UDim2.new(0, 0, 0, 0)
configBtn.BackgroundTransparency = 1
configBtn.Text = "‚öôÔ∏è"
configBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
configBtn.TextSize = 20
configBtn.Font = Enum.Font.Gotham
configBtn.Parent = buttonContainer

-- Bot√£o Minimizar/Maximizar
local minMaxBtn = Instance.new("TextButton")
minMaxBtn.Size = UDim2.new(0, 30, 1, 0)
minMaxBtn.Position = UDim2.new(0, 30, 0, 0)
minMaxBtn.BackgroundTransparency = 1
minMaxBtn.Text = "‚àí"
minMaxBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
minMaxBtn.TextSize = 24
minMaxBtn.Font = Enum.Font.GothamBold
minMaxBtn.Parent = buttonContainer

-- Bot√£o Fechar
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 1, 0)
closeBtn.Position = UDim2.new(0, 60, 0, 0)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "‚úï"
closeBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
closeBtn.TextSize = 18
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = buttonContainer

-- Bot√£o Ajuda
local helpBtn = Instance.new("TextButton")
helpBtn.Size = UDim2.new(0, 30, 1, 0)
helpBtn.Position = UDim2.new(0, 90, 0, 0)
helpBtn.BackgroundTransparency = 1
helpBtn.Text = "?"
helpBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
helpBtn.TextSize = 20
helpBtn.Font = Enum.Font.GothamBold
helpBtn.Parent = buttonContainer

-- √Årea de Conte√∫do
local contentArea = Instance.new("ScrollingFrame")
contentArea.Name = "ContentArea"
contentArea.Size = UDim2.new(1, -20, 1, -60)
contentArea.Position = UDim2.new(0, 10, 0, 55)
contentArea.BackgroundTransparency = 1
contentArea.BorderSizePixel = 0
contentArea.ScrollBarThickness = 4
contentArea.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
contentArea.CanvasSize = UDim2.new(0, 0, 0, 150)
contentArea.Parent = mainFrame

-- Dragging
local dragging = false
local dragStart
local startPos

topBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

topBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if dragging then
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
end)

-- Fechar
closeBtn.MouseButton1Click:Connect(function() screenGui:Destroy() end)
closeBtn.TouchTap:Connect(function() screenGui:Destroy() end)

-- Minimizar/Maximizar
local minimized = false
local originalSize = mainFrame.Size
local minimizedSize = UDim2.new(0, 480, 0, 45)

minMaxBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        mainFrame:TweenSize(minimizedSize, "Out", "Quad", 0.2, true)
        minMaxBtn.Text = "+"
        contentArea.Visible = false
    else
        mainFrame:TweenSize(originalSize, "Out", "Quad", 0.2, true)
        minMaxBtn.Text = "‚àí"
        contentArea.Visible = true
    end
end)

-- Config e Ajuda
configBtn.MouseButton1Click:Connect(function()
    print("Abrir configura√ß√µes")
end)

helpBtn.MouseButton1Click:Connect(function()
    print("Ajuda - NCHUB v1.0")
end)

-- Atualizar canvas size
local function UpdateCanvas()
    local height = 0
    for _, v in pairs(contentArea:GetChildren()) do
        if v:IsA("Frame") or v:IsA("TextButton") then
            height = height + v.Size.Y.Offset + 10
        elseif v:IsA("TextLabel") then
            height = height + v.Size.Y.Offset + 5
        end
    end
    contentArea.CanvasSize = UDim2.new(0, 0, 0, height + 20)
end

-- Adiciona UIListLayout pra scroll funcionar melhor (sem bagun√ßar teu c√≥digo)
local uiList = Instance.new("UIListLayout")
uiList.SortOrder = Enum.SortOrder.LayoutOrder
uiList.Padding = UDim.new(0, 8)
uiList.Parent = contentArea

-- Atualiza UpdateCanvas pra usar AbsoluteContentSize
local oldUpdate = UpdateCanvas
UpdateCanvas = function()
    task.wait(0.1)
    contentArea.CanvasSize = UDim2.new(0, 0, 0, uiList.AbsoluteContentSize.Y + 60)
end

-- SUA BIBLIOTECA TERMINA AQUI, AGORA VAMOS ADICIONAR AS FUN√á√ïES REAIS

-- Primeiro, remover o placeholder
for _, v in pairs(contentArea:GetChildren()) do
    if v:IsA("TextLabel") and v.Text:find("Adicione") then
        v:Destroy()
    end
end

-- ========== VARI√ÅVEIS GLOBAIS ==========
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Estados das fun√ß√µes
local functions = {
    autoGun = false,
    autoCollect = false,
    autoShoot = false,
    killAll = false,
    espMurder = false,
    espSheriff = false,
    espInnocent = false,
    wallhack = false,
    fly = false,
    noclip = false,
    infiniteJump = false,
    antiAfk = false,
    fullBright = false
}

-- ========== FUN√á√ïES REAIS ==========

-- Fun√ß√£o para encontrar a arma no mapa
local function FindGun()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Tool") and (v.Name:lower():find("gun") or v.Name:lower():find("pistol") or v.Name:lower():find("revolver")) then
            return v
        end
    end
    return nil
end

-- Fun√ß√£o para encontrar todos os jogadores
local function GetPlayers()
    local players = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            table.insert(players, player)
        end
    end
    return players
end

-- Fun√ß√£o para identificar o papel no MM2 (corrigida)
local function GetPlayerRole(player)
    if not player or not player.Character then return "Innocent" end
    
    local char = player.Character
    local backpack = player.Backpack
    
    if char:FindFirstChild("Knife") or backpack:FindFirstChild("Knife") then
        return "Murderer"
    end
    if char:FindFirstChild("Gun") or backpack:FindFirstChild("Gun") then
        return "Sheriff"
    end
    return "Innocent"
end

-- ========== FUN√á√ïES DE A√á√ÉO ==========

-- Auto Pegar Gun com CFrame (simples e direto)
local function AutoGunFunction()
    if not functions.autoGun then return end
    
    local gun = FindGun()
    if gun and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = LocalPlayer.Character.HumanoidRootPart
        local targetPos = gun.Handle.Position + Vector3.new(0, 3, 0)
        
        hrp.CFrame = CFrame.new(targetPos)
        task.wait(0.15)
        firetouchinterest(hrp, gun.Handle, 0)
        task.wait(0.05)
        firetouchinterest(hrp, gun.Handle, 1)
    end
end

-- Auto Coletar Moedas (corrigido, coleta todas sem break)
local function AutoCollectFunction()
    if not functions.autoCollect then return end
    
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") and (v.Name:lower():find("coin") or v.Name:lower():find("candy") or v.Name:lower():find("money")) then
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = LocalPlayer.Character.HumanoidRootPart
                firetouchinterest(hrp, v, 0)
                task.wait(0.02)
                firetouchinterest(hrp, v, 1)
            end
        end
    end
end

-- Kill All (s√≥ se Murderer)
local function KillAllFunction()
    if not functions.killAll then return end
    
    if GetPlayerRole(LocalPlayer) == "Murderer" then
        for _, player in pairs(GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.Health = 0
            end
        end
    end
end

-- ESP com Highlight (corrigido)
local highlights = {}

local function ESPFunction()
    for _, player in pairs(Players:GetPlayers()) do
        if player == LocalPlayer or not player.Character then continue end
        
        local role = GetPlayerRole(player)
        local shouldShow = (role == "Murderer" and functions.espMurder) or
                           (role == "Sheriff" and functions.espSheriff) or
                           (role == "Innocent" and functions.espInnocent)
        
        if shouldShow then
            if not highlights[player] then
                local hl = Instance.new("Highlight")
                hl.FillTransparency = 0.4
                hl.OutlineTransparency = 0
                
                if role == "Murderer" then
                    hl.FillColor = Color3.fromRGB(255, 0, 0)
                    hl.OutlineColor = Color3.fromRGB(255, 255, 0)
                elseif role == "Sheriff" then
                    hl.FillColor = Color3.fromRGB(0, 100, 255)
                    hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                else
                    hl.FillColor = Color3.fromRGB(0, 255, 0)
                    hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                end
                
                hl.Parent = player.Character
                highlights[player] = hl
            end
        else
            if highlights[player] then
                highlights[player]:Destroy()
                highlights[player] = nil
            end
        end
    end
end

-- Wallhack corrigido (volta ao normal)
local savedTrans = {}

local function WallhackFunction()
    if functions.wallhack then
        for _, part in pairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.Transparency < 0.6 and not part:IsDescendantOf(LocalPlayer.Character) then
                if not savedTrans[part] then
                    savedTrans[part] = part.Transparency
                end
                part.Transparency = 0.8
            end
        end
    else
        for part, trans in pairs(savedTrans) do
            if part and part.Parent then
                part.Transparency = trans
            end
        end
        savedTrans = {}
    end
end

-- ========== FUN√á√ÉO PARA CRIAR BOT√ïES TOGGLE ==========
local function CriarBotaoToggle(texto, corOff, varName)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.BackgroundColor3 = corOff
    btn.Text = texto .. " [OFF]"
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = contentArea
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = btn
    
    btn.MouseButton1Click:Connect(function()
        functions[varName] = not functions[varName]
        if functions[varName] then
            btn.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
            btn.Text = texto .. " [ON]"
        else
            btn.BackgroundColor3 = corOff
            btn.Text = texto .. " [OFF]"
        end
        UpdateCanvas()
    end)
end

-- ========== CRIAR OS BOT√ïES ==========
local autoTitle = Instance.new("TextLabel")
autoTitle.Size = UDim2.new(1, -20, 0, 30)
autoTitle.BackgroundTransparency = 1
autoTitle.Text = "‚ö° AUTO"
autoTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
autoTitle.Font = Enum.Font.GothamBold
autoTitle.TextSize = 18
autoTitle.TextXAlignment = Enum.TextXAlignment.Left
autoTitle.Parent = contentArea

CriarBotaoToggle("üî´ Auto Pegar Gun", Color3.fromRGB(70, 130, 200), "autoGun")
CriarBotaoToggle("üí∞ Auto Coletar Moedas", Color3.fromRGB(70, 180, 70), "autoCollect")
CriarBotaoToggle("üíÄ Kill All", Color3.fromRGB(200, 50, 50), "killAll")

local espTitle = Instance.new("TextLabel")
espTitle.Size = UDim2.new(1, -20, 0, 30)
espTitle.BackgroundTransparency = 1
espTitle.Text = "üëÅÔ∏è ESP"
espTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
espTitle.Font = Enum.Font.GothamBold
espTitle.TextSize = 18
espTitle.TextXAlignment = Enum.TextXAlignment.Left
espTitle.Parent = contentArea

CriarBotaoToggle("üî¥ ESP Murder", Color3.fromRGB(200, 50, 50), "espMurder")
CriarBotaoToggle("üîµ ESP Xerife", Color3.fromRGB(50, 100, 200), "espSheriff")
CriarBotaoToggle("üü¢ ESP Inocente", Color3.fromRGB(50, 200, 50), "espInnocent")
CriarBotaoToggle("üß± Wallhack", Color3.fromRGB(140, 70, 200), "wallhack")

UpdateCanvas()

-- ========== LOOP PRINCIPAL (com delay pra n√£o travar) ==========
RunService.Heartbeat:Connect(function()
    AutoGunFunction()
    AutoCollectFunction()
    KillAllFunction()
    ESPFunction()
    WallhackFunction()
    
    task.wait(0.05)  -- evita timeout no executor
end)

-- Limpeza ESP
Players.PlayerRemoving:Connect(function(plr)
    if highlights[plr] then
        highlights[plr]:Destroy()
        highlights[plr] = nil
    end
end)

print("‚úÖ NCHUB - MM2 carregado com sucesso! Tudo corrigido.")
