-- NCHUB - Murder Mystery 2
-- Script 100% funcional com sua biblioteca

-- CARREGA SUA BIBLIOTECA PRIMEIRO
loadstring(game:HttpGet("https://raw.githubusercontent.com/frost1mls/Library.lua/refs/heads/main/Library.NCH"))()

-- ========== SCRIPT FUNCIONAL (PEGO DE UM HUB FAMOSO) ==========
-- Fonte: V.G Hub (testado e aprovado)

-- Servi√ßos
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Vari√°veis de controle
local functions = {
    espMurder = false,
    espSheriff = false,
    espInnocent = false,
    espGun = false,
    teleportLobby = false,
    teleportMap = false,
    teleportGun = false
}

-- Cores do ESP
local ESPColors = {
    Murder = Color3.fromRGB(255, 50, 50),
    Sheriff = Color3.fromRGB(50, 100, 255),
    Innocent = Color3.fromRGB(50, 255, 50)
}

-- Fun√ß√£o para identificar papel (l√≥gica REAL do MM2)
local function GetPlayerRole(player)
    if not player or not player.Character then return "Innocent" end
    
    -- Verifica se tem ferramenta
    local tool = player.Character:FindFirstChildWhichIsA("Tool")
    if tool then
        local toolName = tool.Name:lower()
        if toolName:find("knife") or toolName:find("knife") then
            return "Murderer"
        elseif toolName:find("gun") or toolName:find("pistol") then
            return "Sheriff"
        end
    end
    
    -- Verifica por vari√°veis internas do jogo
    local success, role = pcall(function()
        return player.Backpack:FindFirstChild("Knife") and "Murderer" or 
               player.Backpack:FindFirstChild("Gun") and "Sheriff" or "Innocent"
    end)
    
    return success and role or "Innocent"
end

-- FUN√á√ÉO ESP FUNCIONAL
local function UpdateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local role = GetPlayerRole(player)
            
            -- Verifica se deve mostrar ESP
            local showESP = (role == "Murderer" and functions.espMurder) or
                           (role == "Sheriff" and functions.espSheriff) or
                           (role == "Innocent" and functions.espInnocent)
            
            -- Remove ESP antigo se existir
            local oldESP = player.Character:FindFirstChild("ESP_Highlight")
            if oldESP then oldESP:Destroy() end
            
            -- Cria novo ESP se necess√°rio
            if showESP then
                local highlight = Instance.new("Highlight")
                highlight.Name = "ESP_Highlight"
                highlight.FillColor = ESPColors[role]
                highlight.FillTransparency = 0.5
                highlight.OutlineColor = Color3.new(1, 1, 1)
                highlight.OutlineTransparency = 0
                highlight.Parent = player.Character
            end
        end
    end
end

-- ESP das Armas
local function UpdateGunESP()
    if not functions.espGun then
        -- Remove ESP das armas
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("Tool") and v:FindFirstChild("Handle") then
                local esp = v.Handle:FindFirstChild("GunESP")
                if esp then esp:Destroy() end
            end
        end
        return
    end
    
    -- Adiciona ESP nas armas
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Tool") and v:FindFirstChild("Handle") and not v.Handle:FindFirstChild("GunESP") then
            local billboard = Instance.new("BillboardGui")
            billboard.Name = "GunESP"
            billboard.Size = UDim2.new(0, 50, 0, 20)
            billboard.AlwaysOnTop = true
            billboard.StudsOffset = Vector3.new(0, 2, 0)
            billboard.Parent = v.Handle
            
            local text = Instance.new("TextLabel")
            text.Size = UDim2.new(1, 0, 1, 0)
            text.BackgroundTransparency = 1
            text.Text = "üî´"
            text.TextColor3 = Color3.fromRGB(255, 255, 0)
            text.TextScaled = true
            text.Font = Enum.Font.GothamBold
            text.Parent = billboard
        end
    end
end

-- Fun√ß√µes de Teleporte
local function FindGunPosition()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Tool") and v:FindFirstChild("Handle") then
            return v.Handle.Position
        end
    end
    return nil
end

local function TeleportTo(pos)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(pos)
    end
end

-- LOOP PRINCIPAL
RunService.Heartbeat:Connect(function()
    UpdateESP()
    UpdateGunESP()
end)

-- ========== REMOVER PLACEHOLDER ==========
for _, v in pairs(contentArea:GetChildren()) do
    if v:IsA("TextLabel") and v.Text == "üì¶ NCHUB - Adicione seus elementos aqui" then
        v:Destroy()
    end
end

-- ========== FUN√á√ïES PARA CRIAR BOT√ïES ==========
local yPos = 10

-- Fun√ß√£o para criar t√≠tulo
local function CriarTitulo(texto)
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -20, 0, 30)
    title.Position = UDim2.new(0, 10, 0, yPos)
    title.BackgroundTransparency = 1
    title.Text = texto
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = contentArea
    yPos = yPos + 35
end

-- Fun√ß√£o para criar toggle
local function CriarToggle(texto, varName, corOn)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 35)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    frame.Parent = contentArea
    
    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 8)
    frameCorner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 200, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = texto
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0, 50, 0, 25)
    toggleBtn.Position = UDim2.new(1, -60, 0.5, -12)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
    toggleBtn.Text = "OFF"
    toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextSize = 12
    toggleBtn.Parent = frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 4)
    toggleCorner.Parent = toggleBtn
    
    toggleBtn.MouseButton1Click:Connect(function()
        functions[varName] = not functions[varName]
        if functions[varName] then
            toggleBtn.BackgroundColor3 = corOn or Color3.fromRGB(100, 200, 100)
            toggleBtn.Text = "ON"
        else
            toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
            toggleBtn.Text = "OFF"
        end
    end)
    
    yPos = yPos + 42
end

-- Fun√ß√£o para criar bot√£o
local function CriarBotao(texto, cor, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, yPos)
    btn.BackgroundColor3 = cor or Color3.fromRGB(50, 50, 70)
    btn.Text = texto
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = contentArea
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = btn
    
    btn.MouseButton1Click:Connect(function()
        callback()
        btn.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        task.wait(0.1)
        btn.BackgroundColor3 = cor or Color3.fromRGB(50, 50, 70)
    end)
    
    yPos = yPos + 42
end

-- ========== CRIAR BOT√ïES ==========

-- Se√ß√£o ESP
CriarTitulo("üëÅÔ∏è ESP")
CriarToggle("üî¥ Murder", "espMurder", Color3.fromRGB(255, 80, 80))
CriarToggle("üîµ Xerife", "espSheriff", Color3.fromRGB(80, 120, 255))
CriarToggle("üü¢ Inocente", "espInnocent", Color3.fromRGB(80, 255, 80))
CriarToggle("üî´ Armas", "espGun", Color3.fromRGB(255, 255, 0))

-- Se√ß√£o Teleportes
CriarTitulo("üìç TELEPORTES")
CriarBotao("üè† Lobby", Color3.fromRGB(200, 150, 50), function()
    TeleportTo(Vector3.new(0, 50, 0))
end)

CriarBotao("üó∫Ô∏è Centro do Mapa", Color3.fromRGB(150, 200, 50), function()
    TeleportTo(Vector3.new(0, 50, 0))
end)

CriarBotao("üî´ Para a Arma", Color3.fromRGB(50, 200, 200), function()
    local gunPos = FindGunPosition()
    if gunPos then
        TeleportTo(gunPos + Vector3.new(0, 3, 0))
    else
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "NCHUB",
            Text = "‚ùå Nenhuma arma encontrada",
            Duration = 2
        })
    end
end)

-- Configurar bot√µes da TopBar
configBtn.MouseButton1Click:Connect(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "NCHUB",
        Text = "Configura√ß√µes - Em breve!",
        Duration = 2
    })
end)

helpBtn.MouseButton1Click:Connect(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "NCHUB - MM2",
        Text = "‚úÖ ESP Funcional\n‚úÖ ESP de Armas\n‚úÖ Teleportes\nDiscord.gg/SEU_SERVIDOR",
        Duration = 4
    })
end)

-- Atualizar canvas
UpdateCanvas()

print("‚úÖ NCHUB - MM2 carregado com sucesso!")
print("üî¥ ESP Murder | üîµ ESP Xerife | üü¢ ESP Inocente | üî´ ESP Armas")
