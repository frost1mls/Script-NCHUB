-- NCHUB - Murder Mystery 2
-- Edi√ß√£o Dia dos Namorados üíò
-- SUA BIBLIOTECA PRESERVADA + FUN√á√ïES CORRIGIDAS

-- Criar tela
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NCHUB"
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Tela de carregamento
local loadingFrame = Instance.new("Frame")
loadingFrame.Name = "Loading"
loadingFrame.Size = UDim2.new(0, 150, 0, 70)
loadingFrame.Position = UDim2.new(0.5, -75, 0.5, -35)
loadingFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
loadingFrame.BackgroundTransparency = 0.1
loadingFrame.BorderSizePixel = 0
loadingFrame.Parent = screenGui
loadingFrame.ZIndex = 10

local loadingCorner = Instance.new("UICorner")
loadingCorner.CornerRadius = UDim.new(0, 12)
loadingCorner.Parent = loadingFrame

local loadingText = Instance.new("TextLabel")
loadingText.Size = UDim2.new(1, 0, 1, 0)
loadingText.BackgroundTransparency = 1
loadingText.Text = "NCHUB"
loadingText.TextColor3 = Color3.fromRGB(255, 255, 255)
loadingText.Font = Enum.Font.GothamBold
loadingText.TextSize = 28
loadingText.Parent = loadingFrame

-- Aguardar 2 segundos
task.wait(2)

loadingFrame:TweenPosition(UDim2.new(0.5, -75, 1.5, 0), "Out", "Quad", 0.5, true)
task.wait(0.5)
loadingFrame:Destroy()

-- GUI Principal
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 380)
mainFrame.Position = UDim2.new(0.5, -225, 0.5, -190)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 16)
mainCorner.Parent = mainFrame

-- TOP BAR
local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(1, 0, 0, 45)
topBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
topBar.BorderSizePixel = 0
topBar.Parent = mainFrame

local topBarCorner = Instance.new("UICorner")
topBarCorner.CornerRadius = UDim.new(0, 16)
topBarCorner.Parent = topBar

-- Nome do Hub
local hubName = Instance.new("TextLabel")
hubName.Size = UDim2.new(0, 150, 1, 0)
hubName.Position = UDim2.new(0, 12, 0, 0)
hubName.BackgroundTransparency = 1
hubName.Text = "NCHUB ‚ù§Ô∏è MM2"
hubName.TextColor3 = Color3.fromRGB(255, 255, 255)
hubName.Font = Enum.Font.GothamBold
hubName.TextSize = 16
hubName.TextXAlignment = Enum.TextXAlignment.Left
hubName.Parent = topBar

-- Container dos bot√µes
local buttonContainer = Instance.new("Frame")
buttonContainer.Size = UDim2.new(0, 120, 1, 0)
buttonContainer.Position = UDim2.new(1, -130, 0, 0)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = topBar

-- Bot√£o Config
local configBtn = Instance.new("TextButton")
configBtn.Size = UDim2.new(0, 30, 1, 0)
configBtn.Position = UDim2.new(0, 0, 0, 0)
configBtn.BackgroundTransparency = 1
configBtn.Text = "‚öôÔ∏è"
configBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
configBtn.TextSize = 20
configBtn.Font = Enum.Font.Gotham
configBtn.Parent = buttonContainer

-- Bot√£o Minimizar/Maximizar
local minMaxBtn = Instance.new("TextButton")
minMaxBtn.Size = UDim2.new(0, 30, 1, 0)
minMaxBtn.Position = UDim2.new(0, 30, 0, 0)
minMaxBtn.BackgroundTransparency = 1
minMaxBtn.Text = "‚àí"
minMaxBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
minMaxBtn.TextSize = 24
minMaxBtn.Font = Enum.Font.GothamBold
minMaxBtn.Parent = buttonContainer

-- Bot√£o Fechar
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 1, 0)
closeBtn.Position = UDim2.new(0, 60, 0, 0)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "‚úï"
closeBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
closeBtn.TextSize = 18
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = buttonContainer

-- Bot√£o Ajuda
local helpBtn = Instance.new("TextButton")
helpBtn.Size = UDim2.new(0, 30, 1, 0)
helpBtn.Position = UDim2.new(0, 90, 0, 0)
helpBtn.BackgroundTransparency = 1
helpBtn.Text = "?"
helpBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
helpBtn.TextSize = 20
helpBtn.Font = Enum.Font.GothamBold
helpBtn.Parent = buttonContainer

-- √Årea de Conte√∫do
local contentArea = Instance.new("ScrollingFrame")
contentArea.Name = "ContentArea"
contentArea.Size = UDim2.new(1, -20, 1, -60)
contentArea.Position = UDim2.new(0, 10, 0, 55)
contentArea.BackgroundTransparency = 1
contentArea.BorderSizePixel = 0
contentArea.ScrollBarThickness = 4
contentArea.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
contentArea.CanvasSize = UDim2.new(0, 0, 0, 0)
contentArea.Parent = mainFrame

-- Dragging
local dragging = false
local dragStart
local startPos

topBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

topBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if dragging then
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
end)

-- Fechar
closeBtn.MouseButton1Click:Connect(function() screenGui:Destroy() end)

-- Minimizar/Maximizar
local minimized = false
local originalSize = mainFrame.Size
local minimizedSize = UDim2.new(0, 450, 0, 45)

minMaxBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        mainFrame:TweenSize(minimizedSize, "Out", "Quad", 0.2, true)
        minMaxBtn.Text = "+"
        contentArea.Visible = false
    else
        mainFrame:TweenSize(originalSize, "Out", "Quad", 0.2, true)
        minMaxBtn.Text = "‚àí"
        contentArea.Visible = true
    end
end)

-- ========== SEU C√ìDIGO AT√â AQUI 100% PRESERVADO ==========

-- Servi√ßos
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Estados das fun√ß√µes
local functions = {
    espMurder = false,
    espSheriff = false,
    espInnocent = false,
    espGun = false,
    aimbot = false,
    silentAim = false,
    infiniteJump = false,
    antiAfk = false,
    fullBright = false,
    autoFarm = false
}

-- Vari√°veis globais
_G.functions = functions

-- ========== FUN√á√ïES AUXILIARES ==========

local function UpdateCanvas()
    local height = 0
    for _, v in pairs(contentArea:GetChildren()) do
        if v:IsA("Frame") or v:IsA("TextButton") then
            height = height + v.Size.Y.Offset + 8
        end
    end
    contentArea.CanvasSize = UDim2.new(0, 0, 0, height + 20)
end

-- Fun√ß√£o para criar bot√µes de a√ß√£o
local function CriarBotao(texto, cor, callback)
    local yPos = #contentArea:GetChildren() * 42
    
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 35)
    btn.Position = UDim2.new(0, 10, 0, yPos)
    btn.BackgroundColor3 = cor or Color3.fromRGB(50, 50, 70)
    btn.Text = texto
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = contentArea
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = btn
    
    btn.MouseButton1Click:Connect(function()
        callback()
        btn.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        task.wait(0.1)
        btn.BackgroundColor3 = cor or Color3.fromRGB(50, 50, 70)
    end)
    
    return btn
end

-- Fun√ß√£o para criar toggles (COM CORRE√á√ÉO)
local function CriarToggle(texto, varName)
    local yPos = #contentArea:GetChildren() * 42
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 35)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    frame.Parent = contentArea
    
    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 8)
    frameCorner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 250, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = texto
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0, 50, 0, 25)
    toggleBtn.Position = UDim2.new(1, -60, 0.5, -12)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
    toggleBtn.Text = "OFF"
    toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextSize = 12
    toggleBtn.Parent = frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 4)
    toggleCorner.Parent = toggleBtn
    
    toggleBtn.MouseButton1Click:Connect(function()
        functions[varName] = not functions[varName]
        if functions[varName] then
            toggleBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
            toggleBtn.Text = "ON"
        else
            toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
            toggleBtn.Text = "OFF"
        end
    end)
    
    return frame
end

-- Fun√ß√£o para identificar pap√©is no MM2
local function GetPlayerRole(player)
    if not player or not player.Character then return "Innocent" end
    
    -- Verifica ferramenta na m√£o
    local tool = player.Character:FindFirstChildWhichIsA("Tool")
    if tool then
        local toolName = tool.Name:lower()
        if toolName:find("knife") or toolName:find("knife") or toolName:find("murder") then
            return "Murderer"
        elseif toolName:find("gun") or toolName:find("pistol") or toolName:find("revolver") then
            return "Sheriff"
        end
    end
    
    -- Verifica por tags espec√≠ficas do jogo (adaptar conforme necess√°rio)
    if player.Character:FindFirstChild("MURDERER_TAG") then
        return "Murderer"
    elseif player.Character:FindFirstChild("SHERIFF_TAG") then
        return "Sheriff"
    end
    
    return "Innocent"
end

-- Fun√ß√£o ESP corrigida
local function UpdateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local role = GetPlayerRole(player)
            
            -- Decide se deve mostrar ESP baseado nos toggles
            local shouldShow = false
            local espColor = Color3.new(1, 1, 1)
            
            if role == "Murderer" and functions.espMurder then
                shouldShow = true
                espColor = Color3.fromRGB(255, 50, 50) -- Vermelho
            elseif role == "Sheriff" and functions.espSheriff then
                shouldShow = true
                espColor = Color3.fromRGB(50, 100, 255) -- Azul
            elseif role == "Innocent" and functions.espInnocent then
                shouldShow = true
                espColor = Color3.fromRGB(50, 255, 50) -- Verde
            end
            
            -- ESP da arma
            if functions.espGun then
                for _, tool in pairs(workspace:GetDescendants()) do
                    if tool:IsA("Tool") and tool:FindFirstChild("Handle") then
                        if not tool:FindFirstChild("GunESP") then
                            local billboard = Instance.new("BillboardGui")
                            billboard.Name = "GunESP"
                            billboard.Size = UDim2.new(0, 50, 0, 20)
                            billboard.AlwaysOnTop = true
                            billboard.StudsOffset = Vector3.new(0, 2, 0)
                            billboard.Parent = tool.Handle
                            
                            local text = Instance.new("TextLabel")
                            text.Size = UDim2.new(1, 0, 1, 0)
                            text.BackgroundTransparency = 1
                            text.Text = "üî´ ARMA"
                            text.TextColor3 = Color3.fromRGB(255, 255, 0)
                            text.TextScaled = true
                            text.Font = Enum.Font.GothamBold
                            text.Parent = billboard
                        end
                    end
                end
            else
                -- Remove ESP das armas
                for _, tool in pairs(workspace:GetDescendants()) do
                    if tool:IsA("Tool") and tool:FindFirstChild("Handle") then
                        local esp = tool.Handle:FindFirstChild("GunESP")
                        if esp then esp:Destroy() end
                    end
                end
            end
            
            -- Aplica ou remove o ESP do jogador
            if shouldShow then
                if not player.Character:FindFirstChild("ESP_Highlight") then
                    local highlight = Instance.new("Highlight")
                    highlight.Name = "ESP_Highlight"
                    highlight.FillColor = espColor
                    highlight.FillTransparency = 0.5
                    highlight.OutlineColor = Color3.new(1, 1, 1)
                    highlight.OutlineTransparency = 0
                    highlight.Parent = player.Character
                else
                    player.Character.ESP_Highlight.FillColor = espColor
                end
            else
                local highlight = player.Character:FindFirstChild("ESP_Highlight")
                if highlight then highlight:Destroy() end
            end
        end
    end
end

-- Teleport function corrigida
local function TeleportTo(position)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = LocalPlayer.Character.HumanoidRootPart
        -- Tween suave pro teleporte
        local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local goal = {CFrame = CFrame.new(position)}
        local tween = TweenService:Create(hrp, tweenInfo, goal)
        tween:Play()
        
        -- Feedback visual
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "NCHUB",
            Text = "Teleportando...",
            Duration = 1
        })
    end
end

-- Fun√ß√£o pra encontrar arma
local function FindGun()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Tool") and (v.Name:lower():find("gun") or v.Name:lower():find("pistol") or v.Name:lower():find("revolver")) then
            return v
        end
    end
    return nil
end

-- Fun√ß√£o pra encontrar o lobby
local function FindLobby()
    -- Tenta achar o spawn do jogo
    for _, v in pairs(workspace:GetDescendants()) do
        if v.Name:lower():find("lobby") or v.Name:lower():find("spawn") then
            return v.Position
        end
    end
    -- Fallback
    return Vector3.new(0, 50, 0)
end

-- ========== ADICIONANDO OS BOT√ïES (SEM O CANDY) ==========

-- T√≠tulo da se√ß√£o AUTO
local autoTitle = Instance.new("TextLabel")
autoTitle.Size = UDim2.new(1, -20, 0, 30)
autoTitle.Position = UDim2.new(0, 10, 0, 10)
autoTitle.BackgroundTransparency = 1
autoTitle.Text = "‚ö° AUTO FARM (Dia dos Namorados ‚ù§Ô∏è)"
autoTitle.TextColor3 = Color3.fromRGB(255, 100, 150)
autoTitle.Font = Enum.Font.GothamBold
autoTitle.TextSize = 16
autoTitle.TextXAlignment = Enum.TextXAlignment.Left
autoTitle.Parent = contentArea

CriarToggle("üí∞ Auto Farm (Moedas)", "autoFarm")  -- Renomeado de Candy
CriarToggle("üî´ Auto Pegar Gun", "autoGun")

-- Se√ß√£o ESP
local espTitle = Instance.new("TextLabel")
espTitle.Size = UDim2.new(1, -20, 0, 30)
espTitle.Position = UDim2.new(0, 10, 0, 150)
espTitle.BackgroundTransparency = 1
espTitle.Text = "üëÅÔ∏è ESP"
espTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
espTitle.Font = Enum.Font.GothamBold
espTitle.TextSize = 16
espTitle.TextXAlignment = Enum.TextXAlignment.Left
espTitle.Parent = contentArea

CriarToggle("üî¥ ESP Murder", "espMurder")
CriarToggle("üîµ ESP Xerife", "espSheriff")
CriarToggle("üü¢ ESP Inocente", "espInnocent")
CriarToggle("üî´ ESP Arma", "espGun")

-- Se√ß√£o PLAYER
local playerTitle = Instance.new("TextLabel")
playerTitle.Size = UDim2.new(1, -20, 0, 30)
playerTitle.Position = UDim2.new(0, 10, 0, 330)
playerTitle.BackgroundTransparency = 1
playerTitle.Text = "ü¶∏ PLAYER"
playerTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
playerTitle.Font = Enum.Font.GothamBold
playerTitle.TextSize = 16
playerTitle.TextXAlignment = Enum.TextXAlignment.Left
playerTitle.Parent = contentArea

CriarToggle("üéØ Aimbot", "aimbot")
CriarToggle("ü§´ Silent Aim", "silentAim")
CriarToggle("‚òÅÔ∏è Infinite Jump", "infiniteJump")
CriarToggle("üí§ Anti AFK", "antiAfk")
CriarToggle("üí° Full Bright", "fullBright")

-- Se√ß√£o TELEPORT
local tpTitle = Instance.new("TextLabel")
tpTitle.Size = UDim2.new(1, -20, 0, 30)
tpTitle.Position = UDim2.new(0, 10, 0, 510)
tpTitle.BackgroundTransparency = 1
tpTitle.Text = "üìç TELEPORTES"
tpTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
tpTitle.Font = Enum.Font.GothamBold
tpTitle.TextSize = 16
tpTitle.TextXAlignment = Enum.TextXAlignment.Left
tpTitle.Parent = contentArea

-- Bot√µes de teleporte corrigidos
CriarBotao("üè† Teleport Lobby", Color3.fromRGB(200, 150, 50), function()
    TeleportTo(FindLobby())
end)

CriarBotao("üó∫Ô∏è Teleport Centro do Mapa", Color3.fromRGB(150, 200, 50), function()
    TeleportTo(Vector3.new(0, 50, 0))
end)

CriarBotao("üî´ Teleport Arma", Color3.fromRGB(50, 200, 200), function()
    local gun = FindGun()
    if gun then
        TeleportTo(gun.Position + Vector3.new(0, 3, 0))
    else
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "NCHUB",
            Text = "‚ùå Nenhuma arma encontrada",
            Duration = 2
        })
    end
end)

-- Config e Ajuda
configBtn.MouseButton1Click:Connect(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "NCHUB",
        Text = "Configura√ß√µes - Em breve!",
        Duration = 2
    })
end)

helpBtn.MouseButton1Click:Connect(function()
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "NCHUB - Dia dos Namorados ‚ù§Ô∏è",
        Text = "Vers√£o 2.0\nESP corrigido\nTeleportes funcionando\nDiscord.gg/SEU_SERVIDOR",
        Duration = 4
    })
end)

UpdateCanvas()

-- ========== LOOP PRINCIPAL ==========
RunService.Heartbeat:Connect(function()
    UpdateESP()
    
    -- Full Bright
    if functions.fullBright then
        game.Lighting.Brightness = 2
        game.Lighting.Ambient = Color3.new(1, 1, 1)
    else
        game.Lighting.Brightness = 1
        game.Lighting.Ambient = Color3.new(0.5, 0.5, 0.5)
    end
    
    -- Aimbot/Silent Aim (implementar depois)
    if functions.aimbot then
        -- L√≥gica do aimbot
    end
end)

-- Anti AFK
LocalPlayer.Idled:Connect(function()
    if functions.antiAfk then
        local VirtualUser = game:GetService("VirtualUser")
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- Infinite Jump
UserInputService.JumpRequest:Connect(function()
    if functions.infiniteJump and LocalPlayer.Character then
        local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:ChangeState("Jumping")
        end
    end
end)

print("‚úÖ NCHUB - Edi√ß√£o Dia dos Namorados carregado!")
print("‚ù§Ô∏è ESP corrigido | Teleportes funcionando")
