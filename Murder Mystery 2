-- NCHUB - Vers√£o Final Corrigida (Bot√µes + Logo Circular)
-- ID: 136836598337495

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LP = Players.LocalPlayer

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NCHUB"
screenGui.Parent = LP:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- [INTRODU√á√ÉO]
local loadingFrame = Instance.new("Frame")
loadingFrame.Size = UDim2.new(0, 150, 0, 70)
loadingFrame.Position = UDim2.new(0.5, -75, 0.5, -35)
loadingFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
loadingFrame.Parent = screenGui
loadingFrame.ZIndex = 10
Instance.new("UICorner", loadingFrame).CornerRadius = UDim.new(0, 12)

local loadingText = Instance.new("TextLabel")
loadingText.Size = UDim2.new(1, 0, 1, 0)
loadingText.Text = "NCHUB"
loadingText.TextColor3 = Color3.fromRGB(255, 255, 255)
loadingText.Font = Enum.Font.GothamBold
loadingText.TextSize = 28
loadingText.BackgroundTransparency = 1
loadingText.Parent = loadingFrame

-- [GUI PRINCIPAL]
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 420, 0, 340)
mainFrame.Position = UDim2.new(0.5, -210, 0.5, -170)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
mainFrame.ClipsDescendants = true
mainFrame.Visible = false 
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 16)

-- TOP BAR
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 45)
topBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
topBar.Parent = mainFrame
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 16)

-- LOGO DA TOPBAR (Circular e Clean)
local hubLogo = Instance.new("ImageLabel")
hubLogo.Name = "HubLogo"
hubLogo.Size = UDim2.new(0, 36, 0, 36)
hubLogo.Position = UDim2.new(0, 8, 0.5, -18)
hubLogo.BackgroundTransparency = 1
hubLogo.Image = "rbxassetid://136836598337495"
hubLogo.ScaleType = Enum.ScaleType.Fit
hubLogo.Parent = topBar
Instance.new("UICorner", hubLogo).CornerRadius = UDim.new(1, 0)

local hubName = Instance.new("TextLabel")
hubName.Size = UDim2.new(0, 120, 1, 0)
hubName.Position = UDim2.new(0, 52, 0, 0)
hubName.BackgroundTransparency = 1
hubName.Text = "NCHUB"
hubName.TextColor3 = Color3.fromRGB(255, 255, 255)
hubName.Font = Enum.Font.GothamBold
hubName.TextSize = 18
hubName.TextXAlignment = Enum.TextXAlignment.Left
hubName.Parent = topBar

-- [BOT√ïES DA TOPBAR]
local buttonContainer = Instance.new("Frame")
buttonContainer.Size = UDim2.new(0, 120, 1, 0)
buttonContainer.Position = UDim2.new(1, -130, 0, 0)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = topBar

local function CreateTopBtn(pos, img, parent)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 30, 1, 0)
    btn.Position = pos
    btn.BackgroundTransparency = 1
    btn.Text = ""
    btn.Parent = parent
    
    local icon = Instance.new("ImageLabel")
    icon.Size = UDim2.new(0, 22, 0, 22)
    icon.Position = UDim2.new(0.5, -11, 0.5, -11)
    icon.BackgroundTransparency = 1
    icon.Image = "rbxassetid://" .. img
    icon.ScaleType = Enum.ScaleType.Fit
    icon.Parent = btn
    
    return btn, icon
end

local configBtn, configIcon = CreateTopBtn(UDim2.new(0, 0, 0, 0), "90478803942823", buttonContainer)
local minMaxBtn, minMaxIcon = CreateTopBtn(UDim2.new(0, 30, 0, 0), "80618521858488", buttonContainer)
local closeBtn, closeIcon = CreateTopBtn(UDim2.new(0, 60, 0, 0), "91221634288964", buttonContainer)
local helpBtn, helpIcon = CreateTopBtn(UDim2.new(0, 90, 0, 0), "95556025403965", buttonContainer)

-- [FUN√á√ïES DRAG]
local function MakeDraggable(obj, dragObj)
    local dragging, dragStart, startPos
    obj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true 
            dragStart = input.Position 
            startPos = dragObj.Position
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            dragObj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    
    obj.InputEnded:Connect(function() 
        dragging = false 
    end)
end

MakeDraggable(topBar, mainFrame)

-- [L√ìGICA DOS BOT√ïES]
closeBtn.MouseButton1Click:Connect(function() 
    screenGui:Destroy() 
end)

local minimized = false
minMaxBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        mainFrame:TweenSize(UDim2.new(0, 420, 0, 45), "Out", "Quad", 0.2, true)
        minMaxIcon.Image = "rbxassetid://90771774993802"
    else
        mainFrame:TweenSize(UDim2.new(0, 420, 0, 340), "Out", "Quad", 0.2, true)
        minMaxIcon.Image = "rbxassetid://80618521858488"
    end
end)

-- [INTRO + BAL√ÉO P√ìS-INTRO]
task.wait(2)
loadingFrame:TweenPosition(UDim2.new(0.5, -75, 1.5, 0), "Out", "Quad", 0.5, true)
task.wait(0.5)
loadingFrame:Destroy()

local toggleBtn = Instance.new("ImageButton")
toggleBtn.Name = "ToggleButton"
toggleBtn.Size = UDim2.new(0, 60, 0, 60)
toggleBtn.Position = UDim2.new(0, 15, 0.5, -30)
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
toggleBtn.BackgroundTransparency = 0.1
toggleBtn.Image = "rbxassetid://136836598337495"
toggleBtn.ScaleType = Enum.ScaleType.Fit
toggleBtn.Parent = screenGui
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1, 0)
Instance.new("UIStroke", toggleBtn).Thickness = 2.5

MakeDraggable(toggleBtn, toggleBtn)
toggleBtn.MouseButton1Click:Connect(function() 
    mainFrame.Visible = not mainFrame.Visible 
end)

mainFrame.Visible = true

-- ==================== AUTOFARM MM2 (DENTRO DO HUB) ====================

-- Vari√°veis do autofarm
local isRunning = false
local velocidade = 30
local Char = LP.Character or LP.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart")
local Humanoid = Char:WaitForChild("Humanoid")

-- Criar frame do autofarm DENTRO do mainFrame
local farmFrame = Instance.new("Frame")
farmFrame.Name = "AutoFarmFrame"
farmFrame.Size = UDim2.new(1, -20, 1, -60)
farmFrame.Position = UDim2.new(0, 10, 0, 50)
farmFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
farmFrame.BackgroundTransparency = 0.2
farmFrame.Parent = mainFrame
Instance.new("UICorner", farmFrame).CornerRadius = UDim.new(0, 12)

-- T√≠tulo
local farmTitle = Instance.new("TextLabel")
farmTitle.Size = UDim2.new(1, 0, 0, 30)
farmTitle.Position = UDim2.new(0, 0, 0, 10)
farmTitle.BackgroundTransparency = 1
farmTitle.Text = "‚öôÔ∏è AUTOFARM MM2"
farmTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
farmTitle.Font = Enum.Font.GothamBold
farmTitle.TextSize = 18
farmTitle.Parent = farmFrame

-- Status
local statusText = Instance.new("TextLabel")
statusText.Size = UDim2.new(1, -20, 0, 35)
statusText.Position = UDim2.new(0, 10, 0, 45)
statusText.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
statusText.Text = "üî¥ DESLIGADO"
statusText.TextColor3 = Color3.fromRGB(255, 100, 100)
statusText.Font = Enum.Font.GothamBold
statusText.TextSize = 16
statusText.Parent = farmFrame
Instance.new("UICorner", statusText).CornerRadius = UDim.new(0, 8)

-- Bot√£o liga/desliga
local farmButton = Instance.new("TextButton")
farmButton.Size = UDim2.new(1, -20, 0, 40)
farmButton.Position = UDim2.new(0, 10, 0, 90)
farmButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
farmButton.Text = "LIGAR (T)"
farmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
farmButton.Font = Enum.Font.GothamBold
farmButton.TextSize = 18
farmButton.Parent = farmFrame
Instance.new("UICorner", farmButton).CornerRadius = UDim.new(0, 8)

-- Velocidade
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0.4, -5, 0, 30)
speedLabel.Position = UDim2.new(0, 10, 0, 140)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Velocidade:"
speedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextSize = 14
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = farmFrame

local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0.6, -15, 0, 30)
speedBox.Position = UDim2.new(0.4, 5, 0, 140)
speedBox.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
speedBox.Text = "30"
speedBox.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 14
speedBox.PlaceholderText = "30"
speedBox.Parent = farmFrame
Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0, 6)

-- ==================== FUN√á√ïES DO AUTOFARM ====================

local function encontrarMoedaMaisProxima()
    local mapa = nil
    for _, obj in ipairs(workspace:GetChildren()) do
        if obj:FindFirstChild("CoinContainer") or obj:FindFirstChild("Coins") then
            mapa = obj
            break
        end
    end
    
    if not mapa then return nil end
    
    local container = mapa:FindFirstChild("CoinContainer") or mapa:FindFirstChild("Coins")
    if not container then return nil end
    
    local moedaMaisProxima = nil
    local menorDistancia = math.huge
    
    for _, moeda in ipairs(container:GetChildren()) do
        local visual = moeda:FindFirstChild("CoinVisual")
        if visual and not visual:GetAttribute("Collected") then
            local distancia = (HRP.Position - moeda.Position).Magnitude
            if distancia < menorDistancia then
                moedaMaisProxima = moeda
                menorDistancia = distancia
            end
        end
    end
    
    return moedaMaisProxima
end

local function irAteMoeda(moeda)
    if not moeda or not HRP or not Humanoid then return end
    
    Humanoid:ChangeState(Enum.HumanoidStateType.Physics)
    
    local distancia = (HRP.Position - moeda.Position).Magnitude
    local tempoViagem = distancia / velocidade
    
    local tween = TweenService:Create(
        HRP, 
        TweenInfo.new(tempoViagem, Enum.EasingStyle.Linear),
        {CFrame = moeda.CFrame}
    )
    
    tween:Play()
    tween.Completed:Wait()
    
    Humanoid:ChangeState(Enum.HumanoidStateType.Running)
end

local function atualizarInterface()
    if isRunning then
        statusText.Text = "üü¢ LIGADO"
        statusText.TextColor3 = Color3.fromRGB(100, 255, 100)
        farmButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        farmButton.Text = "DESLIGAR (T)"
    else
        statusText.Text = "üî¥ DESLIGADO"
        statusText.TextColor3 = Color3.fromRGB(255, 100, 100)
        farmButton.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
        farmButton.Text = "LIGAR (T)"
    end
end

-- Eventos
farmButton.MouseButton1Click:Connect(function()
    isRunning = not isRunning
    atualizarInterface()
end)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.T then
        isRunning = not isRunning
        atualizarInterface()
    end
end)

speedBox.FocusLost:Connect(function()
    local valor = tonumber(speedBox.Text)
    if valor and valor > 0 and valor <= 200 then
        velocidade = valor
    else
        speedBox.Text = tostring(velocidade)
    end
end)

-- Loop principal
spawn(function()
    while true do
        if isRunning then
            local moeda = encontrarMoedaMaisProxima()
            
            if moeda then
                irAteMoeda(moeda)
                
                local visual = moeda:FindFirstChild("CoinVisual")
                if visual then
                    repeat
                        task.wait(0.1)
                    until not visual.Parent or visual:GetAttribute("Collected")
                end
            else
                task.wait(0.5)
            end
        else
            task.wait(0.1)
        end
    end
end)

-- Atualizar personagem
LP.CharacterAdded:Connect(function(novoChar)
    Char = novoChar
    HRP = Char:WaitForChild("HumanoidRootPart")
    Humanoid = Char:WaitForChild("Humanoid")
end)

print("üöÄ NCHUB + Autofarm carregado! Pressione T para ligar/desligar")
